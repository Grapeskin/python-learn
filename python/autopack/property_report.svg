<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1471px" preserveAspectRatio="none" style="width:901px;height:1471px;background:#FFFFFF;" version="1.1" viewBox="0 0 901 1471" width="901px" zoomAndPan="magnify"><defs/><g><rect height="272.0811" style="stroke:#000000;stroke-width:1.5;fill:none;" width="443" x="74" y="420.1729"/><rect height="238.3267" style="stroke:#000000;stroke-width:1.5;fill:none;" width="423" x="84" y="446.9272"/><rect height="96.2861" style="stroke:#000000;stroke-width:1.5;fill:none;" width="278" x="94" y="581.9678"/><rect height="272.0811" style="stroke:#000000;stroke-width:1.5;fill:none;" width="443" x="74" y="706.2539"/><rect height="238.3267" style="stroke:#000000;stroke-width:1.5;fill:none;" width="423" x="84" y="733.0083"/><rect height="96.2861" style="stroke:#000000;stroke-width:1.5;fill:none;" width="278" x="94" y="868.0488"/><rect height="117.0405" style="stroke:#000000;stroke-width:1.5;fill:none;" width="362" x="10" y="992.335"/><rect height="51.5317" style="stroke:#000000;stroke-width:1.5;fill:none;" width="218" x="20" y="1050.8438"/><rect height="292.8584" style="stroke:#000000;stroke-width:1.5;fill:none;" width="874" x="20" y="1123.3755"/><rect height="51.5317" style="stroke:#000000;stroke-width:1.5;fill:none;" width="278" x="94" y="1213.6616"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="62" x2="62" y1="39.1201" y2="1433.2339"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="166" x2="166" y1="39.1201" y2="1433.2339"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="311" x2="311" y1="39.1201" y2="1433.2339"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="453" x2="453" y1="39.1201" y2="1433.2339"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="644.5" x2="644.5" y1="39.1201" y2="1433.2339"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="837" x2="837" y1="39.1201" y2="1433.2339"/><rect fill="#E2E2F0" height="33.1201" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="64" x="30" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50" x="37" y="28.0439">Network</text><rect fill="#E2E2F0" height="33.1201" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="64" x="30" y="1432.2339"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50" x="37" y="1455.2778">Network</text><rect fill="#E2E2F0" height="33.1201" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="124" x="104" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110" x="111" y="28.0439">PropertyManager</text><rect fill="#E2E2F0" height="33.1201" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="124" x="104" y="1432.2339"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110" x="111" y="1455.2778">PropertyManager</text><path d="M265,10 L357,10 C362,10 362,24.5601 362,24.5601 C362,24.5601 362,39.1201 357,39.1201 L265,39.1201 C260,39.1201 260,24.5601 260,24.5601 C260,24.5601 260,10 265,10 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M357,10 C352,10 352,24.5601 352,24.5601 C352,39.1201 357,39.1201 357,39.1201 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="265" y="31.0439">SignalQueue</text><path d="M265,1432.2339 L357,1432.2339 C362,1432.2339 362,1446.7939 362,1446.7939 C362,1446.7939 362,1461.354 357,1461.354 L265,1461.354 C260,1461.354 260,1446.7939 260,1446.7939 C260,1446.7939 260,1432.2339 265,1432.2339 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M357,1432.2339 C352,1432.2339 352,1446.7939 352,1446.7939 C352,1461.354 357,1461.354 357,1461.354 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="265" y="1453.2778">SignalQueue</text><rect fill="#E2E2F0" height="33.1201" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="409" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="416" y="28.0439">APOS_SDK</text><rect fill="#E2E2F0" height="33.1201" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="409" y="1432.2339"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="416" y="1455.2778">APOS_SDK</text><rect fill="#E2E2F0" height="33.1201" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="129" x="580.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115" x="587.5" y="28.0439">Protocol_Interface</text><rect fill="#E2E2F0" height="33.1201" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="129" x="580.5" y="1432.2339"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115" x="587.5" y="1455.2778">Protocol_Interface</text><rect fill="#E2E2F0" height="33.1201" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="94" x="790" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="797" y="28.0439">AppSweeper</text><rect fill="#E2E2F0" height="33.1201" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="94" x="790" y="1432.2339"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="797" y="1455.2778">AppSweeper</text><line style="stroke:#181818;stroke-width:1.0;" x1="62" x2="104" y1="72.8745" y2="72.8745"/><line style="stroke:#181818;stroke-width:1.0;" x1="104" x2="104" y1="72.8745" y2="85.8745"/><line style="stroke:#181818;stroke-width:1.0;" x1="63" x2="104" y1="85.8745" y2="85.8745"/><polygon fill="#181818" points="73,81.8745,63,85.8745,73,89.8745,69,85.8745" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="69" y="68.0181">进程启动</text><polygon fill="#181818" points="154,113.6289,164,117.6289,154,121.6289,158,117.6289" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="62" x2="160" y1="117.6289" y2="117.6289"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="69" y="112.7725">初始化</text><polygon fill="#181818" points="441,145.3833,451,149.3833,441,153.3833,445,149.3833" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="166" x2="447" y1="149.3833" y2="149.3833"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="173" y="144.5269">初始化</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="166" x2="208" y1="181.1377" y2="181.1377"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="208" x2="208" y1="181.1377" y2="194.1377"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="167" x2="208" y1="194.1377" y2="194.1377"/><polygon fill="#181818" points="177,190.1377,167,194.1377,177,198.1377,173,194.1377" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="173" y="176.2813">开启生产快数据线程T1</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="166" x2="208" y1="225.8921" y2="225.8921"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="208" x2="208" y1="225.8921" y2="238.8921"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="167" x2="208" y1="238.8921" y2="238.8921"/><polygon fill="#181818" points="177,234.8921,167,238.8921,177,242.8921,173,238.8921" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="173" y="221.0356">开启生产慢数据线程T2</text><polygon fill="#181818" points="441,266.6465,451,270.6465,441,274.6465,445,270.6465" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="166" x2="447" y1="270.6465" y2="270.6465"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="263" x="173" y="265.79">订阅数据更新主题/FileChange/FileAttrChange</text><polygon fill="#181818" points="633,333.9097,643,337.9097,633,341.9097,637,337.9097" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="453" x2="639" y1="337.9097" y2="337.9097"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="460" y="297.5444">订阅数据更新主题</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="464" y="315.2988">/event/config_file_change -&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="460" y="333.0532">config_file_attribute_change</text><polygon fill="#181818" points="656,401.1729,646,405.1729,656,409.1729,652,405.1729" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="650" x2="836" y1="405.1729" y2="405.1729"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="662" y="364.8076">订阅数据更新主题</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="666" y="382.562">/event/config_file_change -&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="662" y="400.3164">config_file_attribute_change</text><path d="M74,420.1729 L186,420.1729 L186,429.9272 L176,439.9272 L74,439.9272 L74,420.1729 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="272.0811" style="stroke:#000000;stroke-width:1.5;" width="443" x="74" y="420.1729"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67" x="89" y="436.0708">生产线程T1</text><path d="M84,446.9272 L157,446.9272 L157,456.6816 L147,466.6816 L84,466.6816 L84,446.9272 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="238.3267" style="stroke:#000000;stroke-width:1.5;" width="423" x="84" y="446.9272"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28" x="99" y="462.8252">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="55" x="172" y="461.5332">[每300ms]</text><polygon fill="#181818" points="441,486.459,451,490.459,441,494.459,445,490.459" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="166" x2="447" y1="490.459" y2="490.459"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="173" y="485.6025">获取/KeyMop/IsExisted、/Areas/GoodsInfo</text><polygon fill="#181818" points="177,518.2134,167,522.2134,177,526.2134,173,522.2134" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="171" x2="452" y1="522.2134" y2="522.2134"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="183" y="517.3569">结果</text><line style="stroke:#181818;stroke-width:1.0;" x1="166" x2="208" y1="553.9678" y2="553.9678"/><line style="stroke:#181818;stroke-width:1.0;" x1="208" x2="208" y1="553.9678" y2="566.9678"/><line style="stroke:#181818;stroke-width:1.0;" x1="167" x2="208" y1="566.9678" y2="566.9678"/><polygon fill="#181818" points="177,562.9678,167,566.9678,177,570.9678,173,566.9678" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="173" y="549.1113">对比是否变化</text><path d="M94,581.9678 L155,581.9678 L155,591.7222 L145,601.7222 L94,601.7222 L94,581.9678 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="96.2861" style="stroke:#000000;stroke-width:1.5;" width="278" x="94" y="581.9678"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="109" y="597.8657">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="97" x="170" y="596.5737">[有变化 || 强制上报]</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="166" x2="208" y1="625.4995" y2="625.4995"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="208" x2="208" y1="625.4995" y2="638.4995"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="167" x2="208" y1="638.4995" y2="638.4995"/><polygon fill="#181818" points="177,634.4995,167,638.4995,177,642.4995,173,638.4995" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="173" y="620.6431">更新</text><polygon fill="#FF0000" points="299,666.2539,309,670.2539,299,674.2539,303,670.2539" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="166" x2="305" y1="670.2539" y2="670.2539"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="30" x="173" y="665.3975">Push</text><path d="M74,706.2539 L186,706.2539 L186,716.0083 L176,726.0083 L74,726.0083 L74,706.2539 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="272.0811" style="stroke:#000000;stroke-width:1.5;" width="443" x="74" y="706.2539"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67" x="89" y="722.1519">生产线程T2</text><path d="M84,733.0083 L157,733.0083 L157,742.7627 L147,752.7627 L84,752.7627 L84,733.0083 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="238.3267" style="stroke:#000000;stroke-width:1.5;" width="423" x="84" y="733.0083"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28" x="99" y="748.9063">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="32" x="172" y="747.6143">[每5s]</text><polygon fill="#181818" points="441,772.54,451,776.54,441,780.54,445,776.54" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="166" x2="447" y1="776.54" y2="776.54"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202" x="173" y="771.6836">获取/ParamManager/AllParamJson</text><polygon fill="#181818" points="177,804.2944,167,808.2944,177,812.2944,173,808.2944" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="171" x2="452" y1="808.2944" y2="808.2944"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="183" y="803.438">结果</text><line style="stroke:#181818;stroke-width:1.0;" x1="166" x2="208" y1="840.0488" y2="840.0488"/><line style="stroke:#181818;stroke-width:1.0;" x1="208" x2="208" y1="840.0488" y2="853.0488"/><line style="stroke:#181818;stroke-width:1.0;" x1="167" x2="208" y1="853.0488" y2="853.0488"/><polygon fill="#181818" points="177,849.0488,167,853.0488,177,857.0488,173,853.0488" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="173" y="835.1924">对比是否变化</text><path d="M94,868.0488 L155,868.0488 L155,877.8032 L145,887.8032 L94,887.8032 L94,868.0488 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="96.2861" style="stroke:#000000;stroke-width:1.5;" width="278" x="94" y="868.0488"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="109" y="883.9468">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="97" x="170" y="882.6548">[有变化 || 强制上报]</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="166" x2="208" y1="911.5806" y2="911.5806"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="208" x2="208" y1="911.5806" y2="924.5806"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="167" x2="208" y1="924.5806" y2="924.5806"/><polygon fill="#181818" points="177,920.5806,167,924.5806,177,928.5806,173,924.5806" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="173" y="906.7241">更新</text><polygon fill="#FF0000" points="299,952.335,309,956.335,299,960.335,303,956.335" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="166" x2="305" y1="956.335" y2="956.335"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="30" x="173" y="951.4785">Push</text><path d="M10,992.335 L122,992.335 L122,1002.0894 L112,1012.0894 L10,1012.0894 L10,992.335 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="117.0405" style="stroke:#000000;stroke-width:1.5;" width="362" x="10" y="992.335"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67" x="25" y="1008.2329">消费线程T3</text><polygon fill="#FF0000" points="177,1031.8438,167,1035.8438,177,1039.8438,173,1035.8438" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="171" x2="310" y1="1035.8438" y2="1035.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="183" y="1030.9873">Pull</text><path d="M20,1050.8438 L81,1050.8438 L81,1060.5981 L71,1070.5981 L20,1070.5981 L20,1050.8438 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="51.5317" style="stroke:#000000;stroke-width:1.5;" width="218" x="20" y="1050.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="1066.7417">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="65" x="96" y="1065.4497">[返回值 &gt;= 0]</text><polygon fill="#FF0000" points="73,1090.3755,63,1094.3755,73,1098.3755,69,1094.3755" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="67" x2="165" y1="1094.3755" y2="1094.3755"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="79" y="1089.519">上报</text><path d="M20,1123.3755 L81,1123.3755 L81,1133.1299 L71,1143.1299 L20,1143.1299 L20,1123.3755 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="292.8584" style="stroke:#000000;stroke-width:1.5;" width="874" x="20" y="1123.3755"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="1139.2734">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="118" x="96" y="1137.9814">[APP下发变更属性指令]</text><polygon fill="#181818" points="154,1162.9072,164,1166.9072,154,1170.9072,158,1166.9072" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="62" x2="160" y1="1166.9072" y2="1166.9072"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="69" y="1162.0508">属性变更</text><polygon fill="#181818" points="441,1194.6616,451,1198.6616,441,1202.6616,445,1198.6616" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="166" x2="447" y1="1198.6616" y2="1198.6616"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="173" y="1193.8052">属性变更</text><path d="M94,1213.6616 L155,1213.6616 L155,1223.416 L145,1233.416 L94,1233.416 L94,1213.6616 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="51.5317" style="stroke:#000000;stroke-width:1.5;" width="278" x="94" y="1213.6616"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="109" y="1229.5596">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="52" x="170" y="1228.2676">[变更成功]</text><polygon fill="#FF0000" points="299,1253.1934,309,1257.1934,299,1261.1934,303,1257.1934" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="166" x2="305" y1="1257.1934" y2="1257.1934"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="30" x="173" y="1252.3369">Push</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="894" y1="1273.1934" y2="1273.1934"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="85" x="25" y="1285.7993">[应用层变更属性]</text><polygon fill="#181818" points="656,1308.9707,646,1312.9707,656,1316.9707,652,1312.9707" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="650" x2="836" y1="1312.9707" y2="1312.9707"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="662" y="1308.1143">属性变更</text><polygon fill="#181818" points="464,1340.7251,454,1344.7251,464,1348.7251,460,1344.7251" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="458" x2="644" y1="1344.7251" y2="1344.7251"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="470" y="1339.8687">属性变更</text><polygon fill="#181818" points="177,1372.4795,167,1376.4795,177,1380.4795,173,1376.4795" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="171" x2="452" y1="1376.4795" y2="1376.4795"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="183" y="1371.623">属性变更</text><polygon fill="#FF0000" points="299,1404.2339,309,1408.2339,299,1412.2339,303,1408.2339" style="stroke:#FF0000;stroke-width:1.0;"/><line style="stroke:#FF0000;stroke-width:1.0;" x1="166" x2="305" y1="1408.2339" y2="1408.2339"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="30" x="173" y="1403.3774">Push</text><!--MD5=[73a997c5242b20af06706f2af06cffb1]
@startuml

'abstract class AposSdkProtocol {
'    StatusCode AposSdkRead(int32_t handle, BinPack *in_data, BinPack *out_data, int32_t timeout);
'    StatusCode AposSdkWrite(int32_t handle, BinPack *out_data, int32_t timeout);
'    StatusCode AposSdkSendEvent(int32_t handle, const char *event_id, BinPack *in_data);
'    StatusCode AposSdkSetEventSubscribe(int32_t handle, AposSdkEventCallback callback, const char **event_ids, uint32_t event_size);
'    StatusCode AposSdkService(int32_t handle, const char *event_id, BinPack *in_data, BinPack *out_data, int32_t timeout);
'}
'
'note top of AposSdkProtocol:  typedef void (*AposSdkEventCallback)(int32_t handle, const char *event_id, int32_t msg_id, BinPack *in_msg);
'
'abstract class BaseAposIotSdk {
'    AposSdkProtocol apos_sdk;
'}

participant Network
participant PropertyManager
queue SignalQueue
participant APOS_SDK
participant Protocol_Interface
participant AppSweeper

'autonumber
Network -> Network: 进程启动
Network -> PropertyManager: 初始化
PropertyManager -> APOS_SDK: 初始化
PropertyManager - -> PropertyManager: 开启生产快数据线程T1
PropertyManager - -> PropertyManager: 开启生产慢数据线程T2
PropertyManager -> APOS_SDK: 订阅数据更新主题/FileChange/FileAttrChange
APOS_SDK -> Protocol_Interface: 订阅数据更新主题\n /event/config_file_change -> \nconfig_file_attribute_change
AppSweeper -> Protocol_Interface: 订阅数据更新主题\n /event/config_file_change -> \nconfig_file_attribute_change

'PropertyManager -> PropertyManager: 开启线程1，轮询配置文件数据状态
'PropertyManager -> APOS_SDK: 订阅数据更新主题
'APOS_SDK -> Protocol_Interface: 订阅数据更新主题

group 生产线程T1
    loop 每300ms
        PropertyManager -> APOS_SDK: 获取/KeyMop/IsExisted、/Areas/GoodsInfo
        PropertyManager <- - APOS_SDK: 结果
        PropertyManager -> PropertyManager: 对比是否变化
        alt 有变化 || 强制上报
            PropertyManager - -> PropertyManager: 更新
            PropertyManager [#red]-> SignalQueue: Push
        end
    end
end
group 生产线程T2
    loop 每5s
        PropertyManager -> APOS_SDK: 获取/ParamManager/AllParamJson
        PropertyManager <- - APOS_SDK: 结果
        PropertyManager -> PropertyManager: 对比是否变化
        alt 有变化 || 强制上报
            PropertyManager - -> PropertyManager: 更新
            PropertyManager [#red]-> SignalQueue: Push
        end
    end
end
group 消费线程T3
    PropertyManager <[#red]- - SignalQueue: Pull
    alt 返回值 >= 0
        PropertyManager [#red]-> Network: 上报
    end
end

alt APP下发变更属性指令
    Network -> PropertyManager: 属性变更
    PropertyManager -> APOS_SDK: 属性变更
    alt 变更成功
        PropertyManager [#red]-> SignalQueue: Push
    end
else 应用层变更属性
    AppSweeper -> Protocol_Interface: 属性变更
    Protocol_Interface - -> APOS_SDK: 属性变更
    APOS_SDK - -> PropertyManager: 属性变更
    PropertyManager [#red]-> SignalQueue: Push
end

@enduml

@startuml


participant Network
participant PropertyManager
queue SignalQueue
participant APOS_SDK
participant Protocol_Interface
participant AppSweeper

Network -> Network: 进程启动
Network -> PropertyManager: 初始化
PropertyManager -> APOS_SDK: 初始化
PropertyManager - -> PropertyManager: 开启生产快数据线程T1
PropertyManager - -> PropertyManager: 开启生产慢数据线程T2
PropertyManager -> APOS_SDK: 订阅数据更新主题/FileChange/FileAttrChange
APOS_SDK -> Protocol_Interface: 订阅数据更新主题\n /event/config_file_change -> \nconfig_file_attribute_change
AppSweeper -> Protocol_Interface: 订阅数据更新主题\n /event/config_file_change -> \nconfig_file_attribute_change


group 生产线程T1
    loop 每300ms
        PropertyManager -> APOS_SDK: 获取/KeyMop/IsExisted、/Areas/GoodsInfo
        PropertyManager <- - APOS_SDK: 结果
        PropertyManager -> PropertyManager: 对比是否变化
        alt 有变化 || 强制上报
            PropertyManager - -> PropertyManager: 更新
            PropertyManager [#red]-> SignalQueue: Push
        end
    end
end
group 生产线程T2
    loop 每5s
        PropertyManager -> APOS_SDK: 获取/ParamManager/AllParamJson
        PropertyManager <- - APOS_SDK: 结果
        PropertyManager -> PropertyManager: 对比是否变化
        alt 有变化 || 强制上报
            PropertyManager - -> PropertyManager: 更新
            PropertyManager [#red]-> SignalQueue: Push
        end
    end
end
group 消费线程T3
    PropertyManager <[#red]- - SignalQueue: Pull
    alt 返回值 >= 0
        PropertyManager [#red]-> Network: 上报
    end
end

alt APP下发变更属性指令
    Network -> PropertyManager: 属性变更
    PropertyManager -> APOS_SDK: 属性变更
    alt 变更成功
        PropertyManager [#red]-> SignalQueue: Push
    end
else 应用层变更属性
    AppSweeper -> Protocol_Interface: 属性变更
    Protocol_Interface - -> APOS_SDK: 属性变更
    APOS_SDK - -> PropertyManager: 属性变更
    PropertyManager [#red]-> SignalQueue: Push
end

@enduml

PlantUML version 1.2022.5(Sat Apr 30 18:55:52 CST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: GBK
Language: zh
Country: CN
--></g></svg>